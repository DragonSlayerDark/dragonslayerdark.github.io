{"ast":null,"code":"import { FormControl } from '@angular/forms';\nimport { select } from '@ngrx/store';\nimport { PAWLLocalStorage } from 'src/app/exports/enums';\nimport { loadPetBreeds } from 'src/app/store/entities/actions/pet-breed.actions';\nimport { loadPetTypes } from 'src/app/store/entities/actions/pet-type.actions';\nimport { updatePet } from 'src/app/store/entities/actions/pet.actions';\nimport { selectAllPetBreeds } from 'src/app/store/entities/selectors/pet-breed.selectors';\nimport { selectAllPetTypes } from 'src/app/store/entities/selectors/pet-type.selectors';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@ngrx/store\";\nimport * as i2 from \"src/app/auth_services/store/auth.service\";\nimport * as i3 from \"@angular/forms\";\nimport * as i4 from \"src/app/modules/shared/shared.service\";\nimport * as i5 from \"../../../../store/custom/services/app.service\";\nimport * as i6 from \"@angular/common\";\nimport * as i7 from \"@angular/material/stepper\";\nimport * as i8 from \"../../../shared/pipes/image.pipe\";\n\nfunction EditPetComponent_form_7_ng_template_3_Template(rf, ctx) {}\n\nfunction EditPetComponent_form_7_div_8_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r9 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 47);\n    i0.ɵɵlistener(\"click\", function EditPetComponent_form_7_div_8_Template_div_click_0_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r9);\n      const type_r7 = restoredCtx.$implicit;\n      const ctx_r8 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r8.loadPetBreeds(type_r7.id));\n    });\n    i0.ɵɵelementStart(1, \"label\", 48);\n    i0.ɵɵelement(2, \"input\", 49)(3, \"img\", 50);\n    i0.ɵɵpipe(4, \"image\");\n    i0.ɵɵelementStart(5, \"span\", 17);\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd()()();\n  }\n\n  if (rf & 2) {\n    const type_r7 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"for\", type_r7.attributes.name);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"id\", type_r7.attributes.name)(\"value\", type_r7.id);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"src\", i0.ɵɵpipeBind1(4, 5, type_r7.attributes.icon.data == null ? null : type_r7.attributes.icon.data.attributes == null ? null : type_r7.attributes.icon.data.attributes.url), i0.ɵɵsanitizeUrl);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(type_r7.attributes.name);\n  }\n}\n\nfunction EditPetComponent_form_7_ng_template_34_Template(rf, ctx) {}\n\nfunction EditPetComponent_form_7_option_58_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 51);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const breed_r10 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", breed_r10.id);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(breed_r10.attributes.name);\n  }\n}\n\nfunction EditPetComponent_form_7_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r12 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"form\", 6);\n    i0.ɵɵlistener(\"ngSubmit\", function EditPetComponent_form_7_Template_form_ngSubmit_0_listener() {\n      i0.ɵɵrestoreView(_r12);\n\n      const _r5 = i0.ɵɵreference(42);\n\n      const ctx_r11 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r11.onSubmit(_r5));\n    });\n    i0.ɵɵelementStart(1, \"mat-horizontal-stepper\")(2, \"mat-step\");\n    i0.ɵɵtemplate(3, EditPetComponent_form_7_ng_template_3_Template, 0, 0, \"ng-template\", 7);\n    i0.ɵɵelementStart(4, \"div\", 8)(5, \"div\", 9);\n    i0.ɵɵtext(6, \" Especie \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"div\", 10);\n    i0.ɵɵtemplate(8, EditPetComponent_form_7_div_8_Template, 7, 7, \"div\", 11);\n    i0.ɵɵpipe(9, \"async\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(10, \"div\", 9);\n    i0.ɵɵtext(11, \" Tama\\u00F1o \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(12, \"div\", 12)(13, \"div\", 13)(14, \"label\", 14);\n    i0.ɵɵelement(15, \"input\", 15)(16, \"img\", 16);\n    i0.ɵɵelementStart(17, \"span\", 17);\n    i0.ɵɵtext(18, \" Chico\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(19, \"div\", 13)(20, \"label\", 18);\n    i0.ɵɵelement(21, \"input\", 19)(22, \"img\", 20);\n    i0.ɵɵelementStart(23, \"span\", 17);\n    i0.ɵɵtext(24, \" Mediano \");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(25, \"div\", 13)(26, \"label\", 21);\n    i0.ɵɵelement(27, \"input\", 22)(28, \"img\", 23);\n    i0.ɵɵelementStart(29, \"span\", 17);\n    i0.ɵɵtext(30, \" Grande \");\n    i0.ɵɵelementEnd()()()();\n    i0.ɵɵelementStart(31, \"button\", 24);\n    i0.ɵɵlistener(\"click\", function EditPetComponent_form_7_Template_button_click_31_listener() {\n      i0.ɵɵrestoreView(_r12);\n      const ctx_r13 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r13.checkPetBreed());\n    });\n    i0.ɵɵtext(32, \"Continuar\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(33, \"mat-step\");\n    i0.ɵɵtemplate(34, EditPetComponent_form_7_ng_template_34_Template, 0, 0, \"ng-template\", 7);\n    i0.ɵɵelementStart(35, \"div\", 25)(36, \"span\", 26);\n    i0.ɵɵtext(37, \" Fotograf\\u00EDa\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(38, \"div\", 27)(39, \"label\")(40, \"div\", 28);\n    i0.ɵɵelement(41, \"input\", 29, 30)(43, \"img\", 31);\n    i0.ɵɵelementEnd()()()();\n    i0.ɵɵelementStart(44, \"div\", 8)(45, \"label\", 32);\n    i0.ɵɵtext(46, \"Nombre\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(47, \"input\", 33);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(48, \"div\", 8)(49, \"label\", 34);\n    i0.ɵɵtext(50, \"Fecha de nacimiento\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(51, \"input\", 35);\n    i0.ɵɵlistener(\"change\", function EditPetComponent_form_7_Template_input_change_51_listener() {\n      i0.ɵɵrestoreView(_r12);\n      const ctx_r14 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r14.selectVaccineCard());\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(52, \"div\", 8)(53, \"label\", 36);\n    i0.ɵɵtext(54, \"Raza\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(55, \"select\", 37);\n    i0.ɵɵlistener(\"click\", function EditPetComponent_form_7_Template_select_click_55_listener() {\n      i0.ɵɵrestoreView(_r12);\n      const ctx_r15 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r15.checkPetBreed());\n    });\n    i0.ɵɵelementStart(56, \"option\", 38);\n    i0.ɵɵtext(57, \"Primera Raza\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(58, EditPetComponent_form_7_option_58_Template, 2, 2, \"option\", 39);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(59, \"p\", 26);\n    i0.ɵɵtext(60, \"Genero\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(61, \"div\", 8)(62, \"select\", 40)(63, \"option\", 38);\n    i0.ɵɵtext(64, \"Selecciona un genero\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(65, \"option\", 41);\n    i0.ɵɵtext(66, \" Macho\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(67, \"option\", 42);\n    i0.ɵɵtext(68, \" Hembra\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(69, \"div\", 43)(70, \"div\", 44)(71, \"button\", 45);\n    i0.ɵɵtext(72, \"Regresar\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(73, \"div\", 44)(74, \"button\", 46);\n    i0.ɵɵtext(75, \"Guardar\");\n    i0.ɵɵelementEnd()()()()()();\n  }\n\n  if (rf & 2) {\n    const data_r1 = ctx.ngIf;\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"formGroup\", ctx_r0.addPetForm);\n    i0.ɵɵadvance(8);\n    i0.ɵɵproperty(\"ngForOf\", i0.ɵɵpipeBind1(9, 3, ctx_r0.petTypes$));\n    i0.ɵɵadvance(50);\n    i0.ɵɵproperty(\"ngForOf\", data_r1.breeds);\n  }\n}\n\nconst _c0 = function (a0) {\n  return {\n    breeds: a0\n  };\n};\n\nexport let EditPetComponent = /*#__PURE__*/(() => {\n  class EditPetComponent {\n    constructor(store, auth, fb, shared, App) {\n      //falta crear el update de la imagen\n      this.store = store;\n      this.auth = auth;\n      this.fb = fb;\n      this.shared = shared;\n      this.App = App;\n      this.isLinear = false;\n      this.isChecked = true;\n      this.petId = localStorage.getItem(PAWLLocalStorage.SELECTED_PET_ID);\n      this.pet = JSON.parse(localStorage.getItem(PAWLLocalStorage.SELECTED_PET));\n      this.addPetForm = this.fb.group({\n        id: new FormControl(this.petId),\n        especie: new FormControl(this.pet.petTypeId),\n        size: new FormControl(this.pet.petSize),\n        name: new FormControl(this.pet.name),\n        dob: new FormControl(this.pet.dob),\n        raza: new FormControl(this.pet.petBreedId),\n        // segundaraza: new FormControl(),\n        genero: new FormControl(this.pet.gender)\n      });\n    }\n\n    ngOnInit() {\n      this.store.dispatch(loadPetBreeds({\n        pet_type_id: this.pet.petTypeId\n      }));\n      this.store.dispatch(loadPetTypes());\n      this.breeds$ = this.store.pipe(select(selectAllPetBreeds));\n      this.petTypes$ = this.store.pipe(select(selectAllPetTypes));\n      this.App.onActivate();\n    }\n\n    loadPetBreeds(pet_type_id) {\n      this.store.dispatch(loadPetBreeds({\n        pet_type_id: pet_type_id\n      }));\n      this.isChecked = true;\n    }\n\n    checkPetBreed() {\n      if (this.isChecked === false) {\n        return this.shared.sendAlert('warning', 'Especie de mascota no seleccionada', 'Por favor seleccione una especie');\n      }\n    }\n\n    onSubmit(input) {\n      console.log(\"ONSUBMIT\", this.addPetForm.value);\n\n      if (this.addPetForm.invalid) {\n        return this.shared.sendAlert('warning', 'Formulario Invalido', 'Por favor verifique los campos');\n      }\n\n      this.store.dispatch(updatePet({\n        pet: {\n          id: this.petId,\n          name: this.addPetForm.controls['name'].value,\n          dob: this.addPetForm.controls['dob'].value,\n          gender: this.addPetForm.controls['genero'].value,\n          pet_size: this.addPetForm.controls['size'].value,\n          pet_type: this.addPetForm.controls['especie'].value,\n          pet_breed: this.addPetForm.controls['raza'].value,\n          // pet_second_breed: this.addPetForm.controls['segundaraza'].value,\n          user: this.auth.getUser().id,\n          vaccine_card: {\n            vaccine_card: this.vaccineCardType\n          },\n          dewormer: {\n            vaccine_card: this.dewormerType\n          }\n        },\n        img: input.files[0]\n      }));\n      this.isChecked = false;\n    }\n\n    selectVaccineCard() {\n      var _a, _b;\n\n      const dobString = this.addPetForm.get('dob').value;\n      const dob = new Date(dobString);\n      const today = new Date(); // Revisamos que la fecha de nacimiento no sea una fecha futura\n\n      if (dob > today) {\n        this.shared.sendAlert('warning', 'Error', 'La fecha de nacimiento debe ser anterior a la fecha actual');\n        return (_a = this.addPetForm.get('dob')) === null || _a === void 0 ? void 0 : _a.setValue(this.pet.dob);\n      } // Calculamos la diferencia en semanas\n\n\n      const timeDiff = today.getTime() - dob.getTime();\n      const weeksDiff = Math.floor(timeDiff / (1000 * 60 * 60 * 24 * 7)); // Revisamos el tipo de pet y la diferencia en semanas para asignarle una cartilla de vacunacion\n\n      switch (this.pet.petTypeId) {\n        case \"3\":\n          // perro\n          this.vaccineCardType = weeksDiff <= 17 ? 1 : 3;\n          this.dewormerType = 6;\n          break;\n\n        case \"2\":\n          // gato\n          this.vaccineCardType = weeksDiff <= 16 ? 2 : 4;\n          this.dewormerType = 5;\n          break;\n\n        default:\n          this.shared.sendAlert('warning', 'Especie de mascota no eleccionada', 'Por favor seleccione una especie');\n          (_b = this.addPetForm.get('dob')) === null || _b === void 0 ? void 0 : _b.setValue(this.pet.dob);\n          return;\n      }\n    }\n\n  }\n\n  EditPetComponent.ɵfac = function EditPetComponent_Factory(t) {\n    return new (t || EditPetComponent)(i0.ɵɵdirectiveInject(i1.Store), i0.ɵɵdirectiveInject(i2.AuthService), i0.ɵɵdirectiveInject(i3.FormBuilder), i0.ɵɵdirectiveInject(i4.SharedService), i0.ɵɵdirectiveInject(i5.AppService));\n  };\n\n  EditPetComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: EditPetComponent,\n    selectors: [[\"app-edit-pet\"]],\n    decls: 9,\n    vars: 6,\n    consts: [[1, \"content\", \"rounded-3xl\", \"w-full\", \"mt-6\", \"justify-center\", \"box-shadow-base\", \"ng-star-inserted\"], [1, \"py-4\", \"px-10\", \"grid\", \"grid-cols-6\"], [1, \"col-span-6\", \"font-bold\", \"text-center\", \"text-orange-400\", \"text-3xl\"], [1, \"text-gray-400\"], [1, \"rounded-3xl\", \"pyc-1\", \"mx-6\", \"h-2\", \"justify-center\", \"box-shadow-base\"], [\"class\", \"p-4\", 3, \"formGroup\", \"ngSubmit\", 4, \"ngIf\"], [1, \"p-4\", 3, \"formGroup\", \"ngSubmit\"], [\"matStepLabel\", \"\"], [1, \"form-group\"], [1, \"w-full\", \"text-center\", \"font-bold\", \"text-orange\", \"my-4\"], [1, \"grid\", \"grid-cols-2\", \"gap-4\"], [\"class\", \" col-auto \", 3, \"click\", 4, \"ngFor\", \"ngForOf\"], [1, \"form-group\", \"grid\", \"grid-cols-3\", \"gap-4\", \"h-32\", \"relative\", \"pt-8\", \"pb-4\"], [1, \"relative\", \"sizes\"], [\"for\", \"chico\", 1, \"absolute\", \"inset-x-0\", \"bottom-0\"], [\"id\", \"chico\", \"value\", \"small\", \"name\", \"size\", \"type\", \"radio\", \"formControlName\", \"size\"], [\"src\", \"assets/pawprint.svg\", 1, \"w-3/12\", \"m-auto\"], [1, \"mx-auto\", \"my-2\", \"text-center\", \"block\", \"text-gray-400\"], [\"for\", \"mediano\", 1, \"absolute\", \"inset-x-0\", \"bottom-0\"], [\"id\", \"mediano\", \"value\", \"medium\", \"name\", \"size\", \"type\", \"radio\", \"formControlName\", \"size\"], [\"src\", \"assets/pawprint.svg\", 1, \"w-6/12\", \"m-auto\"], [\"for\", \"grande\", 1, \"absolute\", \"inset-x-0\", \"bottom-0\"], [\"id\", \"grande\", \"value\", \"large\", \"name\", \"size\", \"type\", \"radio\", \"formControlName\", \"size\"], [\"src\", \"assets/pawprint.svg\", 1, \"w-9/12\", \"m-auto\"], [\"mat-button\", \"\", \"matStepperNext\", \"\", \"type\", \"button\", 1, \"single_add_button\", 3, \"click\"], [1, \"mx-auto\", \"w-52\", \"text-center\"], [1, \"w-full\", \"text-center\", \"font-bold\", \"text-orange\", \"my-4\", \"block\"], [1, \"relative\", \"w-52\"], [1, \"w-52\", \"h-52\", \"group\", \"hover:bg-gray-200\", \"opacity-60\", \"rounded-full\", \"flex\", \"justify-center\", \"items-center\", \"cursor-pointer\", \"transition\", \"duration-500\"], [\"type\", \"file\"], [\"inputFile\", \"\"], [\"src\", \"assets\\\\icons\\\\imgupload.svg\", 1, \"w-52\", \"h-52\", \"rounded-full\", \"absolute\"], [\"for\", \"nombre\", 1, \"w-full\", \"text-center\", \"font-bold\", \"text-orange\", \"my-4\", \"block\"], [\"id\", \"nombre\", \"name\", \"nombre\", \"type\", \"text\", \"placeholder\", \"Nombre(s)\", \"formControlName\", \"name\", 1, \"text-input\"], [\"for\", \"dob\", 1, \"w-full\", \"text-center\", \"font-bold\", \"text-orange\", \"my-4\", \"block\"], [\"id\", \"dob\", \"name\", \"dob\", \"type\", \"date\", \"formControlName\", \"dob\", 1, \"text-input\", 3, \"change\"], [\"for\", \"raza\", 1, \"w-full\", \"text-center\", \"font-bold\", \"text-orange\", \"my-4\", \"block\"], [\"name\", \"raza\", \"id\", \"raza\", \"formControlName\", \"raza\", 1, \"text-input\", 3, \"click\"], [\"disabled\", \"\", \"selected\", \"\", \"hidden\", \"\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\"], [\"name\", \"genero\", \"id\", \"genero\", \"formControlName\", \"genero\", 1, \"text-input\"], [\"value\", \"male\"], [\"value\", \"female\"], [1, \"form-group\", \"grid\", \"grid-cols-6\", \"gap-4\", \"mt-10\"], [1, \"col-span-3\"], [\"mat-button\", \"\", \"matStepperPrevious\", \"\", \"type\", \"button\", 1, \"single_add_button\"], [\"type\", \"submit\", 1, \"single_add_button_orange\"], [1, \"col-auto\", 3, \"click\"], [3, \"for\"], [\"name\", \"especie\", \"type\", \"radio\", \"formControlName\", \"especie\", 3, \"id\", \"value\"], [1, \"w-8/12\", \"m-auto\", \"rounded-full\", 3, \"src\"], [3, \"value\"]],\n    template: function EditPetComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"h1\", 2)(3, \"span\", 3);\n        i0.ɵɵtext(4, \" Editar a\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtext(5);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelement(6, \"div\", 4);\n        i0.ɵɵtemplate(7, EditPetComponent_form_7_Template, 76, 5, \"form\", 5);\n        i0.ɵɵpipe(8, \"async\");\n        i0.ɵɵelementEnd();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(5);\n        i0.ɵɵtextInterpolate1(\" \", ctx.pet.name, \" \");\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngIf\", i0.ɵɵpureFunction1(4, _c0, i0.ɵɵpipeBind1(8, 2, ctx.breeds$)));\n      }\n    },\n    dependencies: [i6.NgForOf, i6.NgIf, i3.ɵNgNoValidate, i3.NgSelectOption, i3.ɵNgSelectMultipleOption, i3.DefaultValueAccessor, i3.SelectControlValueAccessor, i3.RadioControlValueAccessor, i3.NgControlStatus, i3.NgControlStatusGroup, i3.FormGroupDirective, i3.FormControlName, i7.MatStep, i7.MatStepLabel, i7.MatStepper, i7.MatStepperNext, i7.MatStepperPrevious, i6.AsyncPipe, i8.ImagePipe],\n    styles: [\".mat-horizontal-stepper-header-container{display:none!important}[type=radio][_ngcontent-%COMP%] + img[_ngcontent-%COMP%]{cursor:pointer}[type=radio][_ngcontent-%COMP%]{position:absolute;opacity:0;width:0;height:0}[type=radio][_ngcontent-%COMP%]:checked + img[_ngcontent-%COMP%]{outline:3px solid #FCAF3D}label[_ngcontent-%COMP%]:checked{color:red}.text-input[_ngcontent-%COMP%]{box-shadow:inset 0 0 8px #e2dbca;width:100%;border-radius:1rem;padding:.5rem;font-size:1rem;line-height:1.5rem;--tw-text-opacity: 1;color:rgb(156 163 175 / var(--tw-text-opacity))}.sizes[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + img[_ngcontent-%COMP%]{outline:none!important;filter:invert(56%) sepia(150%) saturate(451%) hue-rotate(333deg) brightness(99%) contrast(88%)}[type=file][_ngcontent-%COMP%] + img[_ngcontent-%COMP%]{cursor:pointer;left:0;top:0}[type=file][_ngcontent-%COMP%]{position:absolute;opacity:0;width:0;height:0}\"]\n  });\n  return EditPetComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}